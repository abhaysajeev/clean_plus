[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Employee",
  "enabled": 1,
  "modified": "2025-07-17 11:11:06.500520",
  "module": "Clean Plus",
  "name": "Employee Add Ons",
  "script": "frappe.ui.form.on('Employee', {\n    cell_number: function(frm) {\n        if (!frm.doc.cell_number) return;\n\n        frappe.call({\n            method: 'frappe.client.get_list',\n            args: {\n                doctype: 'Employee',\n                filters: [\n                    ['cell_number', '=', frm.doc.cell_number],\n                    ['name', '!=', frm.doc.name]\n                ],\n                fields: ['name', 'employee_name', 'cell_number', 'custom_employee_code']\n            },\n            callback: function(response) {\n                if (response.message && response.message.length > 0) {\n                    let table_html = `\n                        <div style=\"max-width: 700px; margin: auto; border: 1px solid #ddd; border-radius: 8px; overflow: hidden; font-size: 13px;\">\n                            <div style=\"padding: 10px;\">\n                                <div class=\"table-responsive\">\n                                    <table style=\"width: 100%; border-collapse: separate; border-spacing: 0;\">\n                                        <thead style=\"background-color:#f8f9fa;\">\n                                            <tr>\n                                                <th style=\"padding: 6px 8px; text-align: left; border-bottom: 1px solid #ddd;\">Employee Code</th>\n                                                <th style=\"padding: 6px 8px; text-align: left; border-bottom: 1px solid #ddd;\">Employee Name</th>\n                                                <th style=\"padding: 6px 8px; text-align: left; border-bottom: 1px solid #ddd;\">Mobile</th>\n                                            </tr>\n                                        </thead>\n                                        <tbody>\n                    `;\n\n                    response.message\n                        .sort((a, b) => {\n                            const aCode = a.custom_employee_code || '';\n                            const bCode = b.custom_employee_code || '';\n                            return aCode.localeCompare(bCode);\n                        })\n                        .forEach(employee => {\n                            table_html += `\n                                <tr>\n                                    <td style=\"padding: 5px 8px; border-top: 1px solid #eee;\">${employee.custom_employee_code || ''}</td>\n                                    <td style=\"padding: 5px 8px; border-top: 1px solid #eee;\">\n                                        <a href=\"/app/employee/${employee.name}\" style=\"color:#007bff; text-decoration:underline;\">${employee.employee_name}</a>\n                                    </td>\n                                    <td style=\"padding: 5px 8px; border-top: 1px solid #eee;\">${employee.cell_number || ''}</td>\n                                </tr>\n                            `;\n                        });\n\n                    table_html += `\n                                        </tbody>\n                                    </table>\n                                </div>\n                            </div>\n                        </div>\n                    `;\n\n                    frappe.msgprint({\n                        title: __('Duplicate Employee List'),\n                        message: table_html,\n                        indicator: 'red'\n                    });\n                }\n            }\n        });\n    },\n    status: function (frm) {\n        if (frm.doc.status === \"Left\"){\n            frm.set_value(\"custom_verification_printed\", 0);\n            frm.refresh_field(\"custom_verification_printed\");\n        }\n        \n        \n    }\n});\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Employee",
  "enabled": 0,
  "modified": "2025-07-14 15:12:26.525832",
  "module": "Clean Plus",
  "name": "Employee Verification",
  "script": "frappe.listview_settings['Employee'] = {\n    onload: function (listview) {\n        listview.page.add_inner_button(__('Employee Verification'), function () {\n            open_employee_verification_dialog();\n        });\n    },\n\n};\n\nfunction open_employee_verification_dialog() {\n    let selected_employees = new Set();\n    let filtered_employees = [];\n\n    const dialog = new frappe.ui.Dialog({\n        title: __('Employee Verification'),\n        size: 'large',\n        fields: [\n            {\n                fieldtype: 'HTML',\n                fieldname: 'filter_section'\n            },\n            {\n                fieldtype: 'HTML',\n                fieldname: 'bulk_action_section'\n            },\n            {\n                fieldtype: 'HTML',\n                fieldname: 'table_html'\n            }\n        ],\n        primary_action_label: 'Print Selected',\n        primary_action: () => {\n            if (selected_employees.size === 0) {\n                frappe.msgprint(__('Please select at least one employee.'));\n                return;\n            }\n        \n            const employee_names = [...selected_employees];\n\n        }\n\n         \n    });\n\n    dialog.show();\n\n    // Render dynamic filters using Frappe UI controls\n    const filter_section = dialog.get_field('filter_section').$wrapper;\n    filter_section.html(`<div class=\"filters\" style=\"display: flex; gap: 15px; margin-bottom: 10px;\"></div>`);\n\n    // Branch Filter\n    const branch_filter = frappe.ui.form.make_control({\n        df: {\n            fieldname: 'branch_filter',\n            label: 'Branch',\n            fieldtype: 'Link',\n            options: 'Branch',\n            change: () => fetch_employees()\n        },\n        parent: filter_section.find('.filters'),\n        render_input: true\n    });\n    branch_filter.make();\n\n    // Department Filter\n    const dept_filter = frappe.ui.form.make_control({\n        df: {\n            fieldname: 'department_filter',\n            label: 'Department',\n            fieldtype: 'Link',\n            options: 'Department',\n            change: () => fetch_employees()\n        },\n        parent: filter_section.find('.filters'),\n        render_input: true\n    });\n    dept_filter.make();\n\n    // Verification Status Filter\n    const status_filter = frappe.ui.form.make_control({\n        df: {\n            fieldname: 'status_filter',\n            label: 'Verification Status',\n            fieldtype: 'Select',\n            options: [\n                { label: 'Select', value: '' },\n                { label: 'Joining', value: 'Joining' },\n                { label: 'Relieving', value: 'Relieving' }\n            ],\n            change: () => fetch_employees()\n        },\n        parent: filter_section.find('.filters'),\n        render_input: true\n    });\n    status_filter.make();\n\n    // Section heading for employee table\n    const bulk_action_html = `\n        <div style=\"display: flex; justify-content: space-between; align-items: center; margin: 10px 0 5px;\">\n            <h5 style=\"margin: 0;\">Employee List</h5>\n        </div>\n    `;\n    dialog.get_field('bulk_action_section').$wrapper.html(bulk_action_html);\n\n    // Initial load\n    fetch_employees();\n\n    function fetch_employees() {\n        const branch = branch_filter.get_value();\n        const department = dept_filter.get_value();\n        const verification_status = status_filter.get_value();\n\n        frappe.call({\n            method: 'frappe.client.get_list',\n            args: {\n                doctype: 'Employee',\n                filters: {\n                    custom_needs_employee_verification: 1,\n                    ...(branch && { branch }),\n                    ...(department && { department })\n                },\n                fields: ['name', 'employee_name', 'custom_referral_code', 'custom_aadhaar_number', 'status'],\n                limit: 100\n            },\n            callback: function (r) {\n                filtered_employees = r.message\n                    .map(emp => ({\n                        name: emp.name,\n                        employee_name: emp.employee_name,\n                        aadhar: emp.custom_aadhaar_number,\n                        referral: emp.custom_referral_code,\n                        status: emp.status === 'Active' ? 'Joining' : 'Relieving'\n                    }))\n                    .filter(emp => {\n                        if (!verification_status) return true;\n                        return emp.status === verification_status;\n                    });\n\n                render_table();\n            }\n        });\n    }\n\n    function render_table() {\n        const wrapper = dialog.get_field('table_html').$wrapper;\n        let html = `\n            <div class=\"table-responsive\" style=\"max-height: 300px; overflow-y: auto; border: 1px solid #ddd; border-radius: 6px;\">\n                <table class=\"table table-hover\" style=\"margin-bottom: 0;\">\n                    <thead style=\"position: sticky; top: 0; background: #f5f5f5; z-index: 1;\">\n                        <tr style=\"border-bottom: 1px solid #ccc;\">\n                            <th style=\"width:30px;\"><input type=\"checkbox\" id=\"select_all\" ${selected_employees.size === filtered_employees.length ? 'checked' : ''}></th>\n                            <th style=\"padding: 10px;\">Employee Name</th>\n                            <th style=\"padding: 10px;\">Aadhar No</th>\n                            <th style=\"padding: 10px;\">Joining or Relieving</th>\n                            <th style=\"padding: 10px;\">Referral Code</th>\n                        </tr>\n                    </thead>\n                    <tbody>\n        `;\n\n        for (const emp of filtered_employees) {\n            const checked = selected_employees.has(emp.name) ? 'checked' : '';\n            html += `\n                <tr style=\"transition: background 0.2s;\">\n                    <td style=\"padding: 8px 12px;\"><input type=\"checkbox\" class=\"emp-checkbox\" data-name=\"${emp.name}\" ${checked}></td>\n                    <td style=\"padding: 8px 12px;\">${emp.employee_name}</td>\n                    <td style=\"padding: 8px 12px;\">${emp.aadhar || ''}</td>\n                    <td style=\"padding: 8px 12px;\">${emp.status}</td>\n                    <td style=\"padding: 8px 12px;\">${emp.referral || ''}</td>\n                </tr>\n            `;\n        }\n\n        html += `\n                    </tbody>\n                </table>\n            </div>\n        `;\n\n        wrapper.html(html);\n\n        // Handle select all\n        wrapper.find('#select_all').on('change', function () {\n            if (this.checked) {\n                filtered_employees.forEach(emp => selected_employees.add(emp.name));\n            } else {\n                selected_employees.clear();\n            }\n            render_table();\n        });\n\n        // Individual checkbox\n        wrapper.find('.emp-checkbox').on('change', function () {\n            const name = $(this).data('name');\n            if (this.checked) {\n                selected_employees.add(name);\n            } else {\n                selected_employees.delete(name);\n            }\n        });\n    }\n}\n",
  "view": "List"
 }
]